
var expect    = require("chai").expect;
const path = require("path")
const trades = require(path.join(__dirname, "../../moduls/trades/trades"));
var expect    = require("chai").expect;
const myTime = require('./../../moduls/time/myTime');

describe('#Route Trades', () => {
  it('All Trades', async () => {
    /*
    req.query.startTime : 2021-11-20
    Level: 10        Modul: route_trades.js  Function: /api/trades   msg: req.query.endTime: 2021-11-20
    Level: 10        Modul: route_trades.js  Function: /api/trades   msg: req.query.settings: {"product":"all"}
    */
        await myTime.setTimestampToday(  1637431119000 , "true")
        let req = {
          query:{
            filter: "all",
            startTime: "2021-10-07",
            endTime: "2021-10-07",
            settings: {product:"all"}
          }  
        }
        let ret = await trades.getTrades(req.query.filter , req.query.startTime  , req.query.endTime , req.query.settings)
        let expected = {  tradeItems: [    {      auftragsnr: 'O3-9C-5WVK3Q',      betrag: -34.36,      typ: 'Geschlossener Trade',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 21:54:55',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WVH9N',      betrag: -57.23,      typ: 'Stop-Loss (ausgeführt)',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 21:44:18',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WVH9N',      betrag: -2.01,      typ: 'GSLO Prämie',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 21:08:09',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WVCKN',      betrag: 104.92,      typ: 'Geschlossener Trade',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 18:52:28',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5VEJJ3',      betrag: 0.38,      typ: 'GSLO Prämie',      produkt: 'US 30 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 18:49:52',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WVCHR',      betrag: 114.49,      typ: 'Geschlossener Trade',      produkt: 'US 30 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 18:49:52',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WJVDZ',      betrag: 0.45,      typ: 'GSLO Prämie',      produkt: 'Germany 40 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 18:49:20',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WVCHD',      betrag: 103.9,      typ: 'Geschlossener Trade',      produkt: 'Germany 40 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 18:49:20',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WVCH7',      betrag: 19.94,      typ: 'Geschlossener Trade',      produkt: 'Germany 40 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 18:49:13',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WV7ZS',      betrag: 121.58,      typ: 'Geschlossener Trade',      produkt: 'US SPX 500 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 17:31:24',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WV7ZF',      betrag: 48.65,      typ: 'Geschlossener Trade',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 17:31:15',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WTQBS',      betrag: -0.52,      typ: 'GSLO Prämie',      produkt: 'EUR/USD',      verlinkt: false,      datum: '07 Okt 2021 14:59:19',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WTPZE',      betrag: -15.07,      typ: 'Stop-Loss (ausgeführt)',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 14:56:47',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WTDJY',      betrag: 15.45,      typ: 'Take-Profit (ausgeführt)',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 13:01:04',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WVH2T',      betrag: 0,      typ: 'Kauf-Auftrag (Markt)',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 21:02:51',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WTWQ1',      betrag: 0,      typ: 'Kauf-Auftrag (Markt)',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 15:43:00',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WTP3L',      betrag: 0,      typ: 'Kauf-Auftrag (Markt)',      produkt: 'US NDAQ 100 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 14:37:26',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WT6FC',      betrag: 0,      typ: 'Kauf-Auftrag (Markt)',      produkt: 'US SPX 500 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 09:42:56',      myid: undefined,      map: [],      pic: false    },    {      auftragsnr: 'O3-9C-5WT3LW',      betrag: 0,      typ: 'Kauf-Auftrag (Markt)',      produkt: 'Germany 40 - Dez 2021',      verlinkt: false,      datum: '07 Okt 2021 09:10:57',      myid: undefined,      map: [],      pic: false    }  ],  products: [    'all',    'US NDAQ 100 - Dez 2021',    'US 30 - Dez 2021',    'Germany 40 - Dez 2021',    'US SPX 500 - Dez 2021',    'EUR/USD'  ],  total: '420.57',  avg: '30.04',  winrate: '64.29',  avgwinner: '58.86',  avgloser: '-21.84',  maxwinner: '121.58',  maxloser: '-57.23'}
        expect(ret).to.deep.equal(expected);
      })
})